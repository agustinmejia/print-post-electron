<!DOCTYPE html>
<html lang="es">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <title>PrintPost V1.1.0</title>
    </head>
    <body class="vh-100 d-flex align-items-center justify-content-center bg-dark">
        <!-- Contenedor con fondo de imagen -->
        <div class="position-relative w-100 h-100" style="background-image: url('../assets/images/background.jpg');background-position: center;background-repeat: no-repeat;background-size: cover;">
            <!-- Div con efecto de vidrio polarizado -->
            <div class="vh-100 w-100 position-absolute top-0 start-0 bg-black bg-opacity-50" style="backdrop-filter: blur(10px);">
                <div class="text-center text-white pt-3">
                    <h1 class="display-4 fw-bold">PrintPost v1.1.0</h1>
                    <p class="lead">Interface de impresión ESC/POS desde http</p>
                    <!-- <button id="btn-test" class="btn btn-success">
                        Probar
                    </button> -->
                    <div class="dropdown">
                        <button class="btn btn-success dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-printer"></i> Impresión de prueba
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" id="btn-test"><i class="bi bi-chat-text me-2"></i>Mensaje de prueba</a></li>
                            <li><a class="dropdown-item" href="#" id="btn-print-ticket"><i class="bi bi-receipt me-2"></i>Ticket y comanda</a></li>
                            <li><a class="dropdown-item" href="#" id="btn-print-close"><i class="bi bi-cash-coin me-2"></i>Cierre de caja</a></li>
                        </ul>
                    </div>
                </div>
                <div id="result" class="mt-3 d-none bg-dark border border-secondary rounded p-4 mx-5 text-white">
                </div>
                <div class="position-absolute bottom-0 end-0 p-1">
                    <small class="text-light" style="font-size: 11px;">DesarrolloCreativo - 202601090115</small>
                </div>
            </div>
        </div>

        <script>
            document.getElementById('btn-test').addEventListener('click', function() {
                document.getElementById('result').style.display = 'block';
                document.getElementById('result').innerHTML = 'Iniciando...';

                fetch('http://127.0.0.1:3010/test')
                    .then(response => {
                        if (!response.ok) {
                            console.log('error')
                        }
                        return response.json();
                    })
                    .then(data => {
                        document.getElementById('result').classList.remove('d-none');
                        let message = '';
                        if(data.success){
                            message += '<li>✔️ Servidor http (<a href="http://localhost:3010" target="_blank">Ver</a>) </li>';
                            if(data.details.print){
                                message += '<li>✔️ Impresora</li>';
                            }else{
                                message += '<li>❌ Impresora</li>';
                            }

                            message = `<ul>${message}</ul>`;
                        }else{
                            message = '❌ '+data.message;
                        }
                        document.getElementById('result').innerHTML = message;
                    })
                    .catch(error => {
                        document.getElementById('result').innerHTML = '❌ Error al obtener los datos: ' + error.message;
                        console.log(error)
                    });
            });

            document.getElementById('btn-print-ticket').addEventListener('click', function() {
                const resultDiv = document.getElementById('result');
                resultDiv.classList.remove('d-none');
                resultDiv.innerHTML = 'Enviando ticket...';

                const body = {
                    "template" : "normal",
                    "company_name": "DesarrolloCreativo",
                    "sale_number": "001",
                    "payment_type" : "Efectivo",
                    "sale_type" : "Mesa",
                    "table_number" : 5,
                    "discount" : 0,
                    "observations" : "Sin aceitunas",
                    "customer" : "Juan Perez",
                    "details" : [
                        {
                            "product" : "Pollo económico",
                            "quantity" : 1,
                            "total" : 12
                        },
                        {
                            "product" : "Hamburguesa completa",
                            "quantity" : 2,
                            "total" : 24
                        },
                        {
                            "product" : "Coca cola 1 lt.",
                            "quantity" : 1,
                            "total" : 10
                        }
                    ]
                };

                fetch('http://127.0.0.1:3010/print', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                })
                .then(response => response.json())
                .then(data => {
                    resultDiv.innerHTML = data.success ? '✅ ' + data.message : '❌ ' + data.message;
                })
                .catch(error => {
                    resultDiv.innerHTML = '❌ Error: ' + error.message;
                    console.error(error);
                });
            });

            document.getElementById('btn-print-close').addEventListener('click', function() {
                const resultDiv = document.getElementById('result');
                resultDiv.classList.remove('d-none');
                resultDiv.innerHTML = 'Enviando cierre de caja...';

                const body = {
                    "template": "cierre_caja",
                    "user": "Juan Perez",
                    "date": "01-01-2026",
                    "opening_amount": 0.00,
                    "income_amount": 0.00,
                    "expenses_amount": 0.00,
                    "closed_amount": 1200.00,
                    "missing_amount": 0.00,
                    "surplus_amount": 0.00,
                    "qr_amount": 150.00,
                    "products": [
                        {
                            "name": "Coca cola 1lt",
                            "opening": 10,
                            "closed": 2
                        },
                        {
                            "name": "Agua mineral",
                            "opening": 6,
                            "closed": 0
                        },
                        {
                            "name": "Trini",
                            "opening": 5,
                            "closed": 1
                        }
                    ]
                };

                fetch('http://127.0.0.1:3010/print', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                })
                .then(response => response.json())
                .then(data => {
                    resultDiv.innerHTML = data.success ? '✅ ' + data.message : '❌ ' + data.message;
                })
                .catch(error => {
                    resultDiv.innerHTML = '❌ Error: ' + error.message;
                    console.error(error);
                });
            });

        </script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
      </body>
</html>
